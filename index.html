<!DOCTYPE HTML>
<html>
  <head>
    <meta name="viewport" content="width=320; user-scalable=no" />
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>PhoneGap</title>
    <link rel="stylesheet" href="master.css" type="text/css" media="screen" title="no title" charset="utf-8">
	  <script type="text/javascript" charset="utf-8" src="phonegap.js"></script>
	  <script src="dojo/dojo.js" type="text/javascript"></script>
	  <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
	  <script type="text/javascript" charset="utf-8">

	dojo.require("dojo.sensor.geolocation");
	dojo.require("dojo.sensor.accelerometer");
	
	var map;
    
    var getLocation = function() {

    	var options = {getHeading: true, onHeadingChange: function(heading){alert(heading);}};
        
    	dojo.sensor.geolocation.getPosition(function(position, unsupported){
			if( unsupported ){
				alert("did not use real location...");
			}
			
			var coords = position.coords;

			loadMap(coords);

			loadCoords(coords);
		
            
		},
		function(error, browser_support){
			alert('unknown error');
		},options);

    }

    var watchLocation = function(){

    	var options = {getHeading: true, onHeadingChange: function(heading){alert(heading);}};
        
		var watch_id = dojo.sensor.geolocation.watchPosition(function(position, unsupported){
			var coords = position.coords;
			var latlng = new google.maps.LatLng(coords.latitude, coords.longitude);
			//map.setCenter(latlng);
			
			loadMap(coords);
			
			loadCoords(coords);
			
		},
		function(error, browser_support){
			alert('unknown watch error');
		},options);
		
    }

    var loadCoords = function(coords){
    	dojo.byId('latitude').innerHTML = coords.latitude;
		dojo.byId('longitude').innerHTML = coords.longitude;
		dojo.byId('heading').innerHTML = coords.simpleHeading + " " + coords.heading;
		dojo.byId('accuracy').innerHTML = coords.accuracy;
    }

    function loadMap(coords){
		if(map){
			var latlng = new google.maps.LatLng(coords.latitude, coords.longitude);
			map.setCenter(latlng);
		}else{
			var latlng = new google.maps.LatLng(coords.latitude, coords.longitude);
            var myOptions = {
              zoom: 16,
              center: latlng,
              mapTypeId: google.maps.MapTypeId.ROADMAP
            };

        	map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
		}
    }

    function watchAccel(){
    	dojo.sensor.accelerometer.watchAccelerometer(function(a){
			dojo.byId('x').innerHTML = a.x;
			dojo.byId('y').innerHTML = a.y;
			dojo.byId('z').innerHTML = a.z;

			console.log(a.x + ", " + a.y + ", " + a.z);

			if( a.orientation == dojo.sensor.accelerometer.PORTRAIT ){
				dojo.byId('orientation').innerHTML = "Portrait";
			}else{
				dojo.byId('orientation').innerHTML = "Landscape";
			}
    	},function(){

    	},{
			frequency: 50,
			getOrientation: true,
			onOrientChange: function(orientation){
				/// CHANGED
				//ÃŸalert('it changed');
				if( orientation == dojo.sensor.accelerometer.PORTRAIT ){
					dojo.query('.btn.large').style({"width" : "308px"});
				}else{
					dojo.query('.btn.large').style({"width" : "520px"});
				}
    		},
    		onShake: function(){
				alert("SHAKE!");
    		}
        });
    }

    function clearWatch(){
		dojo.sensor.accelerometer.clearWatch();
    }

  </script>
  </head>
  <body  id="stage"  class="theme">
    <div id="coords"><span id="latitude"></span>, <span id="longitude"></span> - Accuracy: <span id="accuracy"></span></div>
    <div>Heading: <span id="heading"></span> | <span id="x"></span>, <span id="y"></span>, <span id="z"></span></div>
    <div><span id="orientation">Portrait</span></div>
    
    <a href="#" class="btn large" onclick="getLocation();">Get Location</a>
    
    <a href="#" class="btn large" onclick="watchLocation();">Watch Location</a>
    <a href="#" class="btn large" onclick="watchAccel();">Watch Accel</a>
    <a href="#" class="btn large" onclick="clearWatch();">Clear Watch</a>
 
    <div id="map_canvas" style="width:300px; height:320px"></div> 
  </body>
</html>
